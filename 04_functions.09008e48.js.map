{"version":3,"sources":["src/04_functions.coffee"],"names":[],"mappings":"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","file":"04_functions.09008e48.js","sourceRoot":"..","sourcesContent":["gm = window.gm\nviewport = gm.vport.dom\nlevel = gm.level.dom\ntiles = gm.tiles.dom\nfnc = gm.fnc\n# global functions\n\ngm.ins.pool = (obj, n) ->\n  # create pool of instances\n  ct = 0\n  nm = ''\n  if @[obj.name] == undefined\n    @[obj.name] = {}\n  for j of @[obj.name]\n    ct++\n  # count num of inst's\n  tot = ct + n\n  while ct < tot\n    nm = obj.name + '_' + ct\n    # append number\n    @[obj.name][nm] = new (gm.ins.New)(obj)\n    # add to pool\n    @[obj.name][nm].active = 0\n    # set active\n    ct++\n\ngm.ins.New = (obj) ->\n  for prop of obj\n    @[prop] = obj[prop]\n  return\n\nfor obj of gm.obj\n  gm.ins.pool gm.obj[obj], gm.obj[obj].qty\n\ngm.ins.create = (obj, x, y) ->\n  # create instance\n  o = @[obj.name]\n  if o == undefined\n    @pool obj, 100\n  # if not, make the pool\n  flag = 0\n  for ins of o\n    # for each inst in pool\n    if flag == 0 and o[ins].active == 0\n      # unactivated found\n      o[ins] = new (gm.ins.New)(obj)\n      o[ins].id = ins\n      flag = 1\n      o[ins].active = 1\n      # activate\n      o[ins].x = x\n      o[ins].y = y\n      o[ins].a = 0\n      o[ins].xSpeed = 0\n      o[ins].ySpeed = 0\n      return o[ins]\n  # exit\n  if flag == 0\n    # if never found an unactivated\n    @pool obj, 100\n    # expand pool\n    return @create(obj, x, y)\n\ngm.ins.get = (id) ->\n  for obj of gm.ins\n    for ins of gm.ins[obj]\n      inst = gm.ins[obj][ins]\n      if inst.id == id\n        return inst\n\ngm.ins.rm = (id) ->\n  for obj of gm.ins\n    for ins of gm.ins[obj]\n      inst = gm.ins[obj][ins]\n      if inst.id == id\n        inst.active = 0\n        return inst\n\ngm.newObj = (props, mixins) ->\n  # prop used for props and mixins\n  prop = undefined\n  obj = {}\n  for prop of props\n    if obj.hasOwnProperty(prop)\n      console.log 'Object property conflict! ' + prop\n    obj[prop] = props[prop]\n  n = 0\n  mixins.forEach (mix) ->\n    if typeof mix == 'function'\n      obj[mix.name] = mix\n    for prop of mix\n      if obj.hasOwnProperty(prop)\n        console.log 'Object property conflict! ' + prop\n        obj[prop + '_' + n] = mix[prop]\n        n++\n      else if mix[prop]\n        obj[prop] = mix[prop]\n    return\n  obj\n\nfnc.repo = (e) ->\n  offX = gm.offX\n  offY = gm.offY\n  if e.parentElement == tiles\n    offX *= 0.5\n    offY *= 0.5\n  e.style.left = e.style.xx - offX + 'px'\n  e.style.top = e.style.yy - offY + 'px'\n  e.style.transform = 'rotate(' + e.style.a + 'deg)'\n\n# lookup sprite + subframe\n\nfnc.parseFrame = (spr, sub) ->\n  for shtRef of gm.sheetData.spriteData\n    for sprRef of gm.sheetData.spriteData[shtRef].sprites\n      if spr == sprRef\n        return gm.sheetData.spriteData[shtRef].sprites[sprRef][sub]\n\n# changes the frame of a sprite / tile\n# by shifting the background image location\n\nfnc.chFrame = (element, num, sheet) ->\n  if !element\n    return\n  if !sheet\n    url = element.style.getPropertyValue('background-image').replace(/url\\((['\"])?(.*?)\\1\\)/gi, '$2')\n    # if no sheet, find the first one\n    sheetData = gm.sheetData\n    for i of sheetData\n      for j of sheetData[i]\n        if sheetData[i][j].img == url\n          sheet = sheetData[i][j]\n          break\n  fnc.divAddSheetData element, sheet\n  element.style.backgroundPosition = -1 * ((num % sheet.numX) + sheet.offX) * sheet.gridX + 'px ' + -1 * Math.floor((num / sheet.numX) + sheet.offY) * sheet.gridY + 'px '\n\n# removes a sprite from a container DOM element\n\nfnc.destroySpr = (e) ->\n  if !e\n    return\n  e.parentElement.removeChild e\n\nfnc.searchForSpriteSheet = (search, spriteData) ->\n  for spriteSheet of spriteData\n    for spriteFound of spriteData[spriteSheet].sprites\n      if search == spriteFound\n        return spriteData[spriteSheet]\n\nfnc.searchForTileSheet = (search, tileData) ->\n  for tileSheet of tileData\n    if search == tileSheet\n      return tileSheet\n\nfnc.searchObject = (search, instanceData) ->\n  for object of instanceData\n    for instance of instanceData[object]\n      if search == instance\n        return instanceData[object][instance]\n\nfnc.divInst = (id, x, y, parent) ->\n  @parent = if parent then parent else viewport\n  @element = document.createElement('div')\n  @element.id = id\n  @style = @element.style\n  @style.xx = x\n  @style.yy = y\n\nfnc.divAddSheetData = (element, sheet) ->\n  url = undefined\n  url = window.getComputedStyle(document.getElementById(sheet.source)).getPropertyValue('background-image')\n  element.style.width = sheet.gridX + 'px'\n  element.style.height = sheet.gridY + 'px'\n  element.style.backgroundImage = url\n  element\n\nfnc.sprInst = (id, x, y) ->\n  sprInst = new (fnc.divInst)(id, x, y)\n  sprInst.element.className = 'sprite'\n  foundObject = fnc.searchObject(id, gm.ins)\n  sprite = foundObject.sprite\n  spriteSheet = fnc.searchForSpriteSheet(sprite, gm.sheetData.spriteData)\n  sprInst = fnc.divAddSheetData(sprInst, spriteSheet)\n  sprInst.style.a = 0\n  sprInst.style.frame = 0\n  # default\n  fnc.repo sprInst.element\n  #fnc.chFrame(sprInst, sprInst.style.frame,spriteSheet);\n  sprInst.parent.appendChild sprInst.element\n  sprInst\n\nfnc.tileInst = (id, x, y, index, sheet) ->\n  tileInst = new (fnc.divInst)(id, x, y, tiles)\n  tileInst.element.className = 'tile'\n  tileInst = fnc.divAddSheetData(tileInst, gm.sheetData.tileData[sheet])\n  fnc.repo tileInst.element\n  fnc.chFrame tileInst, index\n  tileInst.parent.appendChild tileInst.element"]}